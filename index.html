<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Real Web Chat</title>

<style>
body {
  background:#0f172a;
  color:#fff;
  font-family: Arial;
  text-align:center;
}
.container {
  max-width:420px;
  margin:auto;
  padding:20px;
}
input, button {
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:6px;
  border:none;
}
button {
  background:#22c55e;
  font-weight:bold;
}
#messages {
  height:260px;
  overflow:auto;
  background:#020617;
  border:1px solid #334155;
  padding:10px;
  margin:10px 0;
}
.msg {
  text-align:left;
  margin:5px 0;
  font-size:14px;
}
</style>
</head>

<body>

<div class="container">
<h2>Ø¯Ø±Ø¯Ø´Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</h2>

<input id="me" placeholder="Ø±Ù‚Ù…Ùƒ (Ù…Ø«Ø§Ù„: 111)">
<input id="to" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø´Ø®Øµ (Ù…Ø«Ø§Ù„: 222)">

<div id="messages"></div>

<input id="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©">
<button onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// ðŸ”´ Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Firebase Ù‡Ù†Ø§
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let unsubscribe = null;

// Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
function sendMessage() {
  const me = document.getElementById("me").value;
  const to = document.getElementById("to").value;
  const text = document.getElementById("text").value;
  if(!me || !to || !text) return;

  const chatId = [me, to].sort().join("_");

  db.collection("chats")
    .doc(chatId)
    .collection("messages")
    .add({
      from: me,
      text: text,
      time: firebase.firestore.FieldValue.serverTimestamp()
    });

  document.getElementById("text").value = "";
  listen(chatId);
}

// Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Real-time)
function listen(chatId) {
  if(unsubscribe) unsubscribe();

  unsubscribe = db.collection("chats")
    .doc(chatId)
    .collection("messages")
    .orderBy("time")
    .onSnapshot(snapshot => {
      const box = document.getElementById("messages");
      box.innerHTML = "";
      snapshot.forEach(doc => {
        box.innerHTML += `<div class="msg">${doc.data().from}: ${doc.data().text}</div>`;
      });
      box.scrollTop = box.scrollHeight;
    });
}
</script>

</body>
</html>
