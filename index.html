<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ›¡ï¸ Ø³ÙƒØ±Ø¨Øª Ø­Ù…Ø§ÙŠØ© Linux Ù…ØªÙ‚Ø¯Ù…</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a192f, #0d1b2a);
            color: #ccd6f6;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(6, 182, 212, 0.1));
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(16, 185, 129, 0.3);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #06b6d4, #3b82f6);
        }

        .logo {
            font-size: 3.5rem;
            margin-bottom: 15px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, #10b981, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        /* Warning Box */
        .warning-box {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(234, 88, 12, 0.1));
            border: 2px solid #f87171;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            position: relative;
        }

        .warning-box::before {
            content: "âš ï¸";
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 2rem;
        }

        .warning-box h3 {
            color: #fbbf24;
            margin-bottom: 15px;
            font-size: 1.5rem;
            margin-right: 40px;
        }

        /* Instructions */
        .instructions {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border-right: 5px solid #3b82f6;
        }

        .instructions h3 {
            color: #60a5fa;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .steps {
            list-style: none;
            counter-reset: step;
        }

        .steps li {
            counter-increment: step;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 10px;
            border: 1px solid #475569;
            position: relative;
            padding-right: 70px;
            transition: all 0.3s ease;
        }

        .steps li:hover {
            border-color: #3b82f6;
            transform: translateX(-5px);
        }

        .steps li::before {
            content: counter(step);
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Code Container */
        .code-container {
            background: #0f172a;
            border-radius: 15px;
            margin: 30px 0;
            overflow: hidden;
            border: 2px solid #334155;
        }

        .code-header {
            background: #1e293b;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #334155;
        }

        .code-header h3 {
            color: #38bdf8;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .copy-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .copy-btn.copied {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        pre {
            padding: 25px;
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        code {
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.8));
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #475569;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: #3b82f6;
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.2);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            display: inline-block;
        }

        .feature-card h4 {
            color: #38bdf8;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .action-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
        }

        /* Disclaimer */
        .disclaimer {
            background: rgba(220, 38, 38, 0.1);
            border: 2px dashed #f87171;
            border-radius: 15px;
            padding: 25px;
            margin-top: 40px;
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .logo {
                font-size: 2.5rem;
            }
            
            .steps li {
                padding-right: 20px;
                padding-left: 60px;
            }
            
            .steps li::before {
                right: auto;
                left: 20px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
        }

        /* Selection Color */
        ::selection {
            background: rgba(16, 185, 129, 0.5);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <header>
            <div class="logo">ğŸ›¡ï¸</div>
            <h1>Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù„Ù†Ø¸Ø§Ù… Linux</h1>
            <p class="subtitle">Ù†Ø³Ø®Ø© Ù…Ø­Ø³Ù†Ø© ÙˆÙ…Ø¹Ø²Ø²Ø© - Ø§Ù„Ø¥ØµØ¯Ø§Ø± 2.0 | Ø­Ù…Ø§ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù†Ø¸Ø§Ù…</p>
        </header>

        <!-- Warning Section -->
        <div class="warning-box">
            <h3>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù… Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
            <p>Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ù…Ø®ØµØµ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…ÙŠÙ† ÙÙ‚Ø·. ÙŠØ±Ø¬Ù‰ Ø§ØªØ®Ø§Ø° Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:</p>
            <ul style="margin-right: 40px; margin-top: 15px;">
                <li>ğŸ”’ Ø§Ø®Ø° Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…</li>
                <li>ğŸ’¡ ÙÙ‡Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªÙŠ ÙŠÙ†ÙØ°Ù‡Ø§ Ø§Ù„Ø³ÙƒØ±Ø¨Øª</li>
                <li>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ù‡ Ø£ÙˆÙ„Ø§Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ¦Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</li>
                <li>ğŸš« Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬</li>
            </ul>
        </div>

        <!-- Instructions Section -->
        <div class="instructions">
            <h3>ğŸ“‹ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©</h3>
            <ol class="steps">
                <li>
                    <strong>Ø­ÙØ¸ Ø§Ù„Ø³ÙƒØ±Ø¨Øª:</strong> Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ ÙˆØ£Ù„ØµÙ‚Ù‡ ÙÙŠ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³Ù… 
                    <code style="background: #1e293b; padding: 2px 8px; border-radius: 4px;">security_advanced.sh</code>
                </li>
                <li>
                    <strong>Ù…Ù†Ø­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:</strong> Ù†ÙØ° Ø§Ù„Ø£Ù…Ø± Ø§Ù„ØªØ§Ù„ÙŠ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†ÙÙŠØ°
                    <code style="background: #1e293b; padding: 2px 8px; border-radius: 4px; display: block; margin-top: 8px;">chmod +x security_advanced.sh</code>
                </li>
                <li>
                    <strong>ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª:</strong> Ø´ØºÙ‘Ù„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙƒÙ…Ø³Ø¤ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…
                    <code style="background: #1e293b; padding: 2px 8px; border-radius: 4px; display: block; margin-top: 8px;">sudo bash security_advanced.sh</code>
                </li>
                <li>
                    <strong>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª:</strong> Ø§ØªØ¨Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© ÙˆØ£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                </li>
            </ol>
        </div>

        <!-- Code Display Section -->
        <div class="code-container">
            <div class="code-header">
                <h3>ğŸ“œ ÙƒÙˆØ¯ Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h3>
                <button class="copy-btn" onclick="copyCode()">
                    <span>ğŸ“‹</span>
                    <span>Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</span>
                </button>
            </div>
            <pre><code id="codeContent">
#!/bin/bash

# ============================================
# ğŸ›¡ï¸ Ø³ÙƒØ±Ø¨Øª Ø­Ù…Ø§ÙŠØ© Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ù†Ø¸Ù… Ø§Ù„Ø´Ø¨ÙŠÙ‡Ø© Ø¨Ù€ Linux
# Ø§Ù„Ø¥ØµØ¯Ø§Ø±: 2.0 | Ù…Ø¹Ø²Ø² ÙˆÙ…Ø­Ø³Ù‘Ù†
# ============================================

clear
echo "==========================================="
echo "ğŸ›¡ï¸  Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - ØªÙØ¹ÙŠÙ„ Ø´Ø§Ù…Ù„"
echo "==========================================="
echo ""

# ğŸ”’ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø³ÙˆØ¯Ùˆ Ø£ÙˆÙ„Ø§Ù‹
if [ "$EUID" -ne 0 ]; then 
    echo "âš ï¸  Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø¨ØµÙ„Ø§Ø­ÙŠØ§Øª root:"
    echo "sudo bash $0"
    exit 1
fi

# ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ù„Ù„Ø¹Ù…Ù„ÙŠØ§Øª
LOG_FILE="/var/log/security_setup_$(date +%Y%m%d_%H%M%S).log"
exec > >(tee -a "$LOG_FILE") 2>&1

echo "ğŸ“‹ Ø¨Ø¯Ø¡ Ø³Ø¬Ù„ Ø§Ù„Ø­Ù…Ø§ÙŠØ©: $(date)"
echo ""

# ============================================
# 1ï¸âƒ£ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØªØ¹Ø²ÙŠØ²Ù‡
# ============================================
echo "ğŸ”„ [1/10] ØªØ­Ø¯ÙŠØ« ÙˆØªØ¹Ø²ÙŠØ² Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ..."
echo "-------------------------------------------"

# ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù…
apt update && apt full-upgrade -y

# ØªØ«Ø¨ÙŠØª Ø£Ø¯ÙˆØ§Øª Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¥Ø¶Ø§ÙÙŠØ©
apt install -y htop iotop iftop sysstat glances lm-sensors

# ØªØ¹Ø²ÙŠØ² Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„
apt install -y auditd audispd-plugins lynis rkhunter chkrootkit

# ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ø¸Ø§Ù…
apt autoremove -y && apt autoclean -y

echo "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØªØ¹Ø²ÙŠØ²Ù‡"
echo ""

# ============================================
# 2ï¸âƒ£ ØªÙƒÙˆÙŠÙ† Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
# ============================================
echo "ğŸ”¥ [2/10] ØªÙƒÙˆÙŠÙ† Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… (UFW)..."
echo "-------------------------------------------"

# Ø¥ÙŠÙ‚Ø§Ù UFW Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ¹Ù…Ù„
ufw --force disable

# Ù‚ÙˆØ§Ø¹Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ØµØ§Ø±Ù…Ø©
ufw default deny incoming
ufw default allow outgoing

# ÙØªØ­ Ø§Ù„Ù…Ù†Ø§ÙØ° Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
ufw allow 2222/tcp comment 'SSH Access'
ufw allow 80/tcp comment 'HTTP'
ufw allow 443/tcp comment 'HTTPS'
ufw allow 53/udp comment 'DNS'
ufw allow 123/udp comment 'NTP'

# ØªÙØ¹ÙŠÙ„ UFW
ufw --force enable

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù€ UFW
echo "ğŸ”¥ ØªØ¹Ø²ÙŠØ² Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª UFW..."
cat > /etc/ufw/after.rules << 'EOF'
# Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ø®ØµØµØ© Ø¥Ø¶Ø§ÙÙŠØ©
-A ufw-before-input -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP
-A ufw-before-input -p tcp --tcp-flags ALL ALL -j DROP
-A ufw-before-input -p tcp --tcp-flags ALL NONE -j DROP

-A ufw-before-input -p tcp --syn -m limit --limit 100/second --limit-burst 150 -j ACCEPT
-A ufw-before-input -p tcp --syn -j DROP

-A ufw-before-input -p icmp --icmp-type echo-request -m limit --limit 1/second -j ACCEPT
EOF

# Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯
ufw reload

echo "âœ… ØªÙ… ØªÙƒÙˆÙŠÙ† Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…"
echo ""

# ============================================
# 3ï¸âƒ£ ØªÙƒÙˆÙŠÙ† SSH Ù…ØªÙ‚Ø¯Ù… ÙˆØ¢Ù…Ù†
# ============================================
echo "ğŸ” [3/10] ØªÙƒÙˆÙŠÙ† SSH Ù…ØªÙ‚Ø¯Ù… ÙˆØ¢Ù…Ù†..."
echo "-------------------------------------------"

# Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup_$(date +%Y%m%d)

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª SSH Ù…Ø­Ø³Ù†Ø©
cat > /etc/ssh/sshd_config.d/10-custom-security.conf << 'EOF'
# ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª SSH Ø§Ù„Ø¢Ù…Ù†Ø© =====
Port 2222
ListenAddress 0.0.0.0
PermitRootLogin no
PasswordAuthentication yes
PubkeyAuthentication yes
ChallengeResponseAuthentication no
Protocol 2
ClientAliveInterval 300
ClientAliveCountMax 2
MaxAuthTries 3
MaxSessions 5
AllowUsers USERNAME_HERE
DenyUsers root admin administrator
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com
KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256
LogLevel VERBOSE
PrintMotd no
PrintLastLog yes
X11Forwarding no
AllowTcpForwarding no
PermitEmptyPasswords no
IgnoreRhosts yes
HostbasedAuthentication no
EOF

# Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
read -p "ğŸ‘¤ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù‡ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„: " SSH_USER
sed -i "s/USERNAME_HERE/$SSH_USER/" /etc/ssh/sshd_config.d/10-custom-security.conf

# Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ SSH (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
read -p "ğŸ”‘ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ SSH Ø¬Ø¯ÙŠØ¯ØŸ (y/n): " CREATE_KEY
if [ "$CREATE_KEY" = "y" ]; then
    su - $SSH_USER -c "ssh-keygen -t ed25519 -f ~/.ssh/id_ed25519 -N ''"
    echo "ğŸ“‹ Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„Ø¹Ø§Ù…:"
    cat /home/$SSH_USER/.ssh/id_ed25519.pub
fi

# Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ SSH
systemctl restart sshd

echo "âœ… ØªÙ… ØªÙƒÙˆÙŠÙ† SSH Ù…ØªÙ‚Ø¯Ù… ÙˆØ¢Ù…Ù†"
echo ""

# ============================================
# 4ï¸âƒ£ ØªÙƒÙˆÙŠÙ† Fail2Ban Ù…ØªÙ‚Ø¯Ù…
# ============================================
echo "â›” [4/10] ØªÙƒÙˆÙŠÙ† Ù†Ø¸Ø§Ù… Ù…Ù†Ø¹ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©..."
echo "-------------------------------------------"

mkdir -p /var/log/fail2ban
touch /var/log/auth.log

cat > /etc/fail2ban/jail.local << 'EOF'
[DEFAULT]
bantime = 3600
findtime = 600
maxretry = 3
destemail = admin@localhost
sender = fail2ban@localhost
action = %(action_mwl)s

[sshd]
enabled = true
port = 2222
filter = sshd
logpath = /var/log/auth.log
maxretry = 3

[sshd-ddos]
enabled = true
port = 2222
filter = sshd-ddos
logpath = /var/log/auth.log
maxretry = 5

[nginx-http-auth]
enabled = true
filter = nginx-http-auth
logpath = /var/log/nginx/error.log
maxretry = 3

[apache-auth]
enabled = true
filter = apache-auth
logpath = /var/log/apache2/error.log
maxretry = 3

[recidive]
enabled = true
filter = recidive
logpath = /var/log/fail2ban.log
action = iptables-allports[name=recidive]
bantime = 604800
findtime = 86400
maxretry = 2
EOF

# Ø³ÙƒØ±Ø¨Øª Ø­Ø¸Ø± IPs Ø¶Ø§Ø±Ø©
cat > /usr/local/bin/block_malicious_ips.sh << 'EOF'
#!/bin/bash
BLOCKLISTS=(
    "https://lists.blocklist.de/lists/all.txt"
    "https://www.spamhaus.org/drop/drop.txt"
    "https://www.spamhaus.org/drop/edrop.txt"
)

IPTABLES_CHAIN="BLOCKLIST"
iptables -N $IPTABLES_CHAIN 2>/dev/null
iptables -F $IPTABLES_CHAIN

for list in "${BLOCKLISTS[@]}"; do
    echo "Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø©: $list"
    curl -s "$list" | grep -Eo '([0-9]{1,3}\.){3}[0-9]{1,3}(/[0-9]{1,2})?' | \
    while read ip; do
        iptables -A $IPTABLES_CHAIN -s "$ip" -j DROP
    done
done

iptables -I INPUT -j $IPTABLES_CHAIN
EOF

chmod +x /usr/local/bin/block_malicious_ips.sh

# ØªÙØ¹ÙŠÙ„ Fail2Ban
systemctl enable fail2ban
systemctl start fail2ban

echo "âœ… ØªÙ… ØªÙƒÙˆÙŠÙ† Ù†Ø¸Ø§Ù… Ù…Ù†Ø¹ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©"
echo ""

# ============================================
# 5ï¸âƒ£ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†ÙˆØ§Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
# ============================================
echo "âš™ï¸ [5/10] ØªØ¹Ø²ÙŠØ² Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†ÙˆØ§Ø© Ø§Ù„Ù†Ø¸Ø§Ù…..."
echo "-------------------------------------------"

cat >> /etc/sysctl.conf << 'EOF'
# ===== Ø£Ù…Ø§Ù† Ø§Ù„Ù†ÙˆØ§Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… =====
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_syn_retries = 2
net.ipv4.tcp_synack_retries = 2
net.ipv4.tcp_max_syn_backlog = 2048
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
kernel.randomize_va_space = 2
vm.swappiness = 10
vm.overcommit_memory = 1
kernel.exec-shield = 1
fs.protected_hardlinks = 1
fs.protected_symlinks = 1
fs.suid_dumpable = 0
EOF

sysctl -p

cat >> /etc/security/limits.conf << 'EOF'
* soft nofile 65535
* hard nofile 65535
* soft nproc 65535
* hard nproc 65535
root soft nofile unlimited
root hard nofile unlimited
EOF

echo "âœ… ØªÙ… ØªØ¹Ø²ÙŠØ² Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†ÙˆØ§Ø© Ø§Ù„Ù†Ø¸Ø§Ù…"
echo ""

# ============================================
# 6ï¸âƒ£ Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…
# ============================================
echo "ğŸ” [6/10] Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ§Ù„ÙØ­Øµ..."
echo "-------------------------------------------"

cat > /usr/local/bin/system_monitor.sh << 'EOF'
#!/bin/bash
LOG_DIR="/var/log/security_monitor"
mkdir -p $LOG_DIR
DATE=$(date +%Y%m%d_%H%M%S)
REPORT="$LOG_DIR/report_$DATE.txt"

echo "===== ØªÙ‚Ø±ÙŠØ± Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Ø¸Ø§Ù… =====" > $REPORT
echo "Ø§Ù„ÙˆÙ‚Øª: $(date)" >> $REPORT
echo "=================================" >> $REPORT

echo -e "\nğŸ” Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©:" >> $REPORT
ps aux --sort=-%cpu | head -20 >> $REPORT

echo -e "\nğŸŒ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„Ø´Ø¨ÙƒÙŠØ© Ø§Ù„Ù†Ø´Ø·Ø©:" >> $REPORT
netstat -tulnp | grep -v "127.0.0.1" >> $REPORT

echo -e "\nğŸ’¾ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø©:" >> $REPORT
free -h >> $REPORT

echo -e "\nğŸ’¿ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚Ø±Øµ:" >> $REPORT
df -h >> $REPORT

echo -e "\nğŸ“‹ Ø¢Ø®Ø± Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„:" >> $REPORT
last -10 >> $REPORT

echo -e "\nğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© ÙÙŠ Ø¢Ø®Ø± 24 Ø³Ø§Ø¹Ø©:" >> $REPORT
find / -type f -mtime -1 -size -10M 2>/dev/null | head -30 >> $REPORT

echo -e "\nğŸ‘ï¸ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø®ÙÙŠØ© ÙÙŠ /home:" >> $REPORT
find /home -name ".*" -type f 2>/dev/null | head -20 >> $REPORT

echo -e "\nâœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ: $REPORT"
EOF

chmod +x /usr/local/bin/system
